<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>홈앤룸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">


</head>
<body>


<header th:replace="templates/header :: header_template"></header>
<div th:if="${session.user==null}">
    <div th:replace="templates/header :: header_modal"></div>
</div>
<div class="container-fluid" style="height:900px">
    <div class="row" style="height: 100%">
        <div class="col-8 fluid" style="padding: 0">
            <div id="map" style="width:100%;height:100%; padding: 0"></div>

        </div>
        <div class="col-4">
            <div class="container-fluid" style="padding: 0">
                <div class="row p-2 bg-secondary justify-content-center">
                    <div class="col-2"></div>
                    <div class="col-6">
                        <input class="form-control me-2" id="search" type="search" placeholder="지역,지하철명"
                               aria-label="Search">
                    </div>
                    <div class="col-4">
                        <button id="search_btn" class="btn btn-dark " type="button" onclick="search()">Search</button>
                    </div>
                </div>
                <div class="row border-bottom">

                    <div class="col-6">
                        <div class="btn-group">
                            <button type="button" class="btn btn dropdown-toggle" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                상세검색
                            </button>
                            <div class="dropdown-menu">
                                <div class="row">
                                    <div class="col-4">
                                        안녕
                                    </div>
                                    <div class="col-8">
                                        <div>메롱</div>
                                        <div>병신</div>
                                    </div>
                                </div>
                            </div>
                            <hr>

                        </div>
                    </div>
                    <div class="col-6 float-right">
                        닫기
                    </div>
                </div>
                <div class="row">
                    <div class="col-4">1</div>
                    <div class="col-4">2</div>
                    <div class="col-4">3</div>
                    <div class="col-4">4</div>

                </div>
            </div>
        </div>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=aad77ce5fb25c098c085b83a13dbad40&libraries=services,clusterer"></script>
<script th:inline="javascript">


    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(37.484661, 126.783171), // 지도의 중심좌표
            level: 3 // 지도의 확대 레벨
        };

    // 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);



    // 마커를 생성합니다
    var marker1 = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(37.484661, 126.783171)
    });
    var marker2 = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(37.484635, 126.783521)
    });
    var marker3 = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(37.484800, 126.783727)
    });

    let markers={marker1,marker2,marker3};

    // 마커가 지도 위에 표시되도록 설정합니다
/*    marker1.setMap(map);
    marker2.setMap(map);
    marker3.setMap(map);*/

        let clusterer = new kakao.maps.MarkerClusterer({
            map: map,
            averageCenter: true,
            minLevel: 2/*,
        minClusterSize: 1*/
        })

    clusterer.addMakers(markers);

    // 지도 이동이 완료되면 호출되는 이벤트 리스너 등록
    kakao.maps.event.addListener(map, 'idle', function () {
        // 현재 지도의 경계 영역 정보 가져오기
        var bounds = map.getBounds();
        var swLatLng = bounds.getSouthWest(); // 서남쪽 좌표 (좌하단)
        var neLatLng = bounds.getNorthEast(); // 동북쪽 좌표 (우상단)

        // 서남쪽 좌표의 위도와 경도
        var swLat = swLatLng.getLat();
        var swLng = swLatLng.getLng();

        // 동북쪽 좌표의 위도와 경도
        var neLat = neLatLng.getLat();
        var neLng = neLatLng.getLng();

        // 위도와 경도 출력하기
        console.log('서남쪽 좌표:', swLat, swLng);
        console.log('동북쪽 좌표:', neLat, neLng);

        // 서버로 위도와 경도를 전달하여 매물 데이터를 요청하거나 처리할 수 있습니다.
        // 예를 들어 AJAX 요청을 사용하여 해당 영역의 매물 정보를 가져올 수 있습니다.

        $.ajax({
            type: 'get',
            url: '/room/roomList',
            data: {
                minLat: swLat,
                minLng: swLng,
                maxLat: neLat,
                maxLng: neLng
            }
        }).done(function (data) {

            /*let clusterer = new kakao.maps.MarkerClusterer({
                map: map,
                averageCenter: true,
                minLevel: 10,
                minClusterSize: 1
            })


            var markers = [];
            for (let i = 0; i < data.length; i++) {
                let marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(data[i].lat, data[i].lng);
                })

                marker.propertyId = data[i].id;

                markers.push(marker);
            }

            clusterer.addMarkers(markers);*/
        }).fail(function (err) {
            alert(err);
        });
    });

    function search() {
        // 장소 검색 객체를 생성합니다
        var ps = new kakao.maps.services.Places();

        // 키워드로 장소를 검색합니다
        ps.keywordSearch($('#search').val(), placesSearchCB);

        // 키워드 검색 완료 시 호출되는 콜백함수 입니다
        function placesSearchCB(data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {

                // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
                // LatLngBounds 객체에 좌표를 추가합니다
                var bounds = new kakao.maps.LatLngBounds();

                bounds.extend(new kakao.maps.LatLng(data[0].y, data[0].x));

                // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
                map.setBounds(bounds);
            }
        }
    }


</script>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>홈앤룸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <style>

        .table {
            border-top: 2px solid;
            border-top-color: black;
        }

        .table th {
            background-color: rgba(128, 128, 128, 0.1);
        }

    </style>
</head>
<body>
<header th:replace="templates/header :: header_template"></header>
<div th:if="${session.user==null}" th:replace="templates/header :: header_modal"></div>

<div class="container-fluid bg-secondary bg-opacity-10" style="padding-top: 50px;padding-right:20%;padding-left: 20%">
    <div class="container bg-white border">
        <h2 class="mb-5">방 내놓기</h2>

        <h5>등록자 정보</h5>
        <table class="table">
            <tr>
                <th class=" col-2">
                    등록자 정보
                </th>
                <td class="col-10">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="registrarInfo" id="inlineRadio1" value="임대인">
                        <label class="form-check-label" for="inlineRadio1">임대인</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="registrarInfo" id="inlineRadio2"
                               value="기존 세입자">
                        <label class="form-check-label" for="inlineRadio2">기존 세입자</label>
                    </div>
                </td>
            </tr>
        </table>

        <h5>위치 정보</h5>
        <table class="table">
            <tr>
                <th class="col-2">
                    건물 유형*
                </th>
                <td class="col-10">
                    <div class="col-5">
                        <select class="form-select col-5" aria-label="Default select example">
                            <option selected>선택</option>
                            <option th:each="value :${T(project.project.domain.enum_type.HouseType).values()}"
                                    th:value="${value}" th:text="${value}"></option>
                        </select>
                    </div>
                </td>
            </tr>
            <tr>
                <th class="col-2">
                    집 형태*
                </th>
                <td class="col-10">
                    <div class="col-5">
                        <select class="form-select" aria-label="Default select example">
                            <option selected>선택</option>
                            <option th:each="value :${T(project.project.domain.enum_type.RoomType).values()}"
                                    th:value="${value}" th:text="${value}"></option>
                        </select>
                    </div>
                </td>
            </tr>
            <tr>
                <th class="col-2">
                    주소*
                </th>
                <td class="col-10">
                    <div class="row mb-2">
                        <div class="col-5">
                            <input type="text" class="form-control" th:id="postcode" th:name="postcode"
                                   placeholder="우편번호">
                        </div>
                        <div class="col-3">
                            <input type="button" class="btn btn-dark" onclick="daumPostcode()" value="우편번호 찾기">
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-8">
                            <input type="text" class="form-control" th:id="address" th:name="address" placeholder="주소">
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-5">
                            <input type="text" class="form-control" th:id="detailAddress" th:name="detailAddress"
                                   placeholder="상세주소">
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control" th:id="extraAddress" th:name="extraAddress"
                                   placeholder="참고항목">
                        </div>
                        <div class="col-4">
                            <input type="button" class="btn btn-dark" onclick="mapView()" value="위치 확인">
                        </div>
                    </div>

                    <div id="map" class="rounded d-flex align-items-center justify-content-center"
                         style="height: 200px;width: 300px;background-color: rgba(128, 128, 128, 0.1);">
                        <div>
                            등록하실 매물의 위치를 표시합니다.
                        </div>
                    </div>

                </td>
            </tr>
        </table>

        <h5>거래 정보</h5>
        <table class="table">
            <tr>
                <th class="col-2">보증금*</th>
                <td class="col-4">
                    <div class="row">
                        <div class="col-8">
                            <input class="form-control">
                        </div>
                        <div class="col-4 text-sm-start">
                            만원
                        </div>
                    </div>
                </td>
                <th class="col-2">월세*</th>
                <td class="col-4">
                    <div class="row">
                        <div class="col-8">
                            <input class="form-control">
                        </div>
                        <div class="col-4 text-sm-start">
                            만원
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <th class="col-2">관리비*</th>
                <td class="col-4">
                    <div class="row">
                        <div class="col-8">
                            <input class="form-control">
                        </div>
                        <div class="col-4 text-sm-start">
                            만원
                        </div>
                    </div>
                </td>
                <th class="col-2">관리비<br>포함내역*</th>
                <td class="col-4">
                    <div class="row ">
                        <div class="col-4 mb-2"th:each="value:${T(project.project.domain.enum_type.MaintenanceList).values()}">
                            <input type="checkbox" class="btn-check btn-sm" th:id="${value}" th:value="${value}"
                                   autocomplete="off">
                            <label class="btn btn-outline-dark btn-sm" th:for="${value}" th:text="${value}"></label>
                        </div>
                    </div>

                </td>
            </tr>

            <tr>
                <th class="col-2">입주 가능일*</th>
                <td colspan="3">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="moveInDate" id="date" value="option1">
                        <label class="form-check-label" for="date">즉시 입주</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="radioNoLabel" id="radioNoLabel1" value="" >
                        <label class="form-check-label" for="radioNoLabel1"></label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-control" name="moveInDate" id="date_input" placeholder="날짜선택">
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>
</body>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=aad77ce5fb25c098c085b83a13dbad40&libraries=services"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
<script>
    //날짜 선택기
    let date=flatpickr(document.getElementById("date_input"),{
        "locale":"ko"
    });
    //주소 검색
    function daumPostcode() {
        new daum.Postcode({
            oncomplete: function (data) {

                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if (data.userSelectedType === 'R') {
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if (data.buildingName !== '' && data.apartment === 'Y') {
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if (extraAddr !== '') {
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                    document.getElementById("extraAddress").value = extraAddr;

                } else {
                    document.getElementById("extraAddress").value = '';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById("address").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById("detailAddress").focus();
                var geocoder = new kakao.maps.services.Geocoder();

                var callback = function (result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        console.log(result);
                    }
                };

                geocoder.addressSearch(addr, callback);
            }
        }).open();
    }

    //위치확인 버튼 클릭시 지도로 위치 보여주기
    function mapView() {
        let mapContainer = document.getElementById('map');
        let mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667),
            level: 5
        };

        let map = new kakao.maps.Map(mapContainer, mapOption);

        //주소 ->좌표 변환 객체
        let geocoder = new kakao.maps.services.Geocoder();


        //주소로 좌표 검색
        geocoder.addressSearch($("#address").val(), function (result, status) {
            if (status == kakao.maps.services.Status.OK) {
                let coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                let marker = new kakao.maps.Marker({
                    map: map,
                    position: coords
                });

                map.setCenter(coords);
            }
        });
    }
</script>
</html>